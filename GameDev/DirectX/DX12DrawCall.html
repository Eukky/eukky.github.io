<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DX12中的Draw Call优化 | META TECH</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
    <meta name="description" content="一个单纯的技术分享站点">
    
    <link rel="preload" href="/assets/css/0.styles.8f3dca9f.css" as="style"><link rel="preload" href="/assets/js/app.0a53806a.js" as="script"><link rel="preload" href="/assets/js/2.e7ab5c73.js" as="script"><link rel="preload" href="/assets/js/1.924d8370.js" as="script"><link rel="preload" href="/assets/js/32.a1d95602.js" as="script"><link rel="prefetch" href="/assets/js/10.0ebf80ed.js"><link rel="prefetch" href="/assets/js/11.535042f9.js"><link rel="prefetch" href="/assets/js/12.d767b8a9.js"><link rel="prefetch" href="/assets/js/13.146adbc0.js"><link rel="prefetch" href="/assets/js/14.cc9595cb.js"><link rel="prefetch" href="/assets/js/15.ca33d6ee.js"><link rel="prefetch" href="/assets/js/16.422ef080.js"><link rel="prefetch" href="/assets/js/17.a2e66896.js"><link rel="prefetch" href="/assets/js/18.44dd0612.js"><link rel="prefetch" href="/assets/js/19.3dcb055b.js"><link rel="prefetch" href="/assets/js/20.c17320aa.js"><link rel="prefetch" href="/assets/js/21.3c44352c.js"><link rel="prefetch" href="/assets/js/22.88ae7534.js"><link rel="prefetch" href="/assets/js/23.58d8ab99.js"><link rel="prefetch" href="/assets/js/24.8d99dffd.js"><link rel="prefetch" href="/assets/js/25.113907d5.js"><link rel="prefetch" href="/assets/js/26.aa357591.js"><link rel="prefetch" href="/assets/js/27.091f926b.js"><link rel="prefetch" href="/assets/js/28.bf558f8e.js"><link rel="prefetch" href="/assets/js/29.30c9cdb0.js"><link rel="prefetch" href="/assets/js/3.c5d67b5d.js"><link rel="prefetch" href="/assets/js/30.446d6b4e.js"><link rel="prefetch" href="/assets/js/31.73bca2f0.js"><link rel="prefetch" href="/assets/js/33.750049c8.js"><link rel="prefetch" href="/assets/js/34.81d11d5a.js"><link rel="prefetch" href="/assets/js/35.bee0e457.js"><link rel="prefetch" href="/assets/js/36.00f8ea73.js"><link rel="prefetch" href="/assets/js/37.54fb757c.js"><link rel="prefetch" href="/assets/js/38.a6d55c54.js"><link rel="prefetch" href="/assets/js/39.5387c729.js"><link rel="prefetch" href="/assets/js/4.95c8e9af.js"><link rel="prefetch" href="/assets/js/40.c6ad81b1.js"><link rel="prefetch" href="/assets/js/41.f7eae51d.js"><link rel="prefetch" href="/assets/js/42.4b5d0a0f.js"><link rel="prefetch" href="/assets/js/43.bbbbdebe.js"><link rel="prefetch" href="/assets/js/44.dc21de04.js"><link rel="prefetch" href="/assets/js/45.3e2c709b.js"><link rel="prefetch" href="/assets/js/46.d470015d.js"><link rel="prefetch" href="/assets/js/47.d04a2811.js"><link rel="prefetch" href="/assets/js/48.018f9f7c.js"><link rel="prefetch" href="/assets/js/5.affefd7c.js"><link rel="prefetch" href="/assets/js/6.0ecbeb87.js"><link rel="prefetch" href="/assets/js/7.203fbb9f.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.82899547.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8f3dca9f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">META TECH</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="游戏开发" class="dropdown-title"><span class="title">游戏开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="游戏开发" class="mobile-dropdown-title"><span class="title">游戏开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/GameDev/Unity/" class="nav-link">
  Unity
</a></li><li class="dropdown-item"><!----> <a href="/GameDev/UnrealEngine/" class="nav-link">
  Unreal Engine
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="APP开发" class="dropdown-title"><span class="title">APP开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="APP开发" class="mobile-dropdown-title"><span class="title">APP开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/AppDev/IOS/" class="nav-link">
  IOS
</a></li><li class="dropdown-item"><!----> <a href="/AppDev/Android/" class="nav-link">
  Android
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他站点" class="dropdown-title"><span class="title">其他站点</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他站点" class="mobile-dropdown-title"><span class="title">其他站点</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://discord.gg/AVeHFqCc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/eukky/eukky.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="游戏开发" class="dropdown-title"><span class="title">游戏开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="游戏开发" class="mobile-dropdown-title"><span class="title">游戏开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/GameDev/Unity/" class="nav-link">
  Unity
</a></li><li class="dropdown-item"><!----> <a href="/GameDev/UnrealEngine/" class="nav-link">
  Unreal Engine
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="APP开发" class="dropdown-title"><span class="title">APP开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="APP开发" class="mobile-dropdown-title"><span class="title">APP开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/AppDev/IOS/" class="nav-link">
  IOS
</a></li><li class="dropdown-item"><!----> <a href="/AppDev/Android/" class="nav-link">
  Android
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他站点" class="dropdown-title"><span class="title">其他站点</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他站点" class="mobile-dropdown-title"><span class="title">其他站点</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://discord.gg/AVeHFqCc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/eukky/eukky.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="dx12中的draw-call优化"><a href="#dx12中的draw-call优化" class="header-anchor">#</a> DX12中的Draw Call优化</h1> <p>Draw call优化是在整个性能优化中非常重要的一环，越多的Draw call就意味着Cpu和Gpu之间的数据传输越多，对于渲染效率的影响也就越大，很多时候渲染效率低下的瓶颈不在于Gpu的运算效率，而在于Gpu的IO效率或者是渲染管线上下文的等待和切换。因此优化Draw call就成了性能优化中一个非常重要的课题。</p> <h2 id="普通的的draw"><a href="#普通的的draw" class="header-anchor">#</a> 普通的的Draw</h2> <p>先来看看普通的绘制手段，例如DX11中的Draw或是DrawIndexed，例如Vulkan中的vkCmdDraw或者是vkCmdDrawndexed，调用这些api会将一串Vertex Buffer和Index Buffer传递给GPU，来将这些顶点组成的三角面片绘制出来，但这些顶点拥有相同的世界矩阵，拥有相同的材质属性，因此调用这些api所得到的结果一般是一个物体对应一个单独的Draw Call。</p> <p>那么问题来了，如果在一个场景中，需要绘制大量相同或是类似的物件，有没有更好的办法来实现呢。于是就有了Instanced Draw的解决方案。</p> <h2 id="instanced-draw"><a href="#instanced-draw" class="header-anchor">#</a> Instanced Draw</h2> <p>在DX12的官方文档中，DX11的Draw和DrawIndexed两个api已经全都整合成了DrawInstanced和DrawIndexedInstanced。</p> <p><img src="/assets/img/DX12API.51ecbbf4.png" alt="DX12API"></p> <p>为什么这两个api可以被整合起来，回想一下Instanced Draw和普通的Draw之间的不同之处。普通的Draw在传递Vertex数据的时候，顶点数据的Layout中每个顶点都包含有一份独特的数据，包括顶点的Postion，顶点的Color，以及该顶点的UV等等。如果在顶点中存放更多的数据，例如在世界空间中的偏移，接着在顶点着色器中进行调用，则可以在同一个Draw Call中绘制出更多的物件出来。只不过这些数据每一个物件的顶点都只需要一份，而不需要每个顶点都保存一份。这样又能够把现存和带宽给节省下来。而这也是Instanced Draw的整体思想所在。</p> <p>当你在DX中去声明一个InputLayout的时候，DX提供了这样一个标识符来帮助你识别该数据是Vertex数据还是Instance数据。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">typedef</span> 
<span class="token keyword">enum</span> <span class="token class-name">D3D12_INPUT_CLASSIFICATION</span>
<span class="token punctuation">{</span>
    D3D12_INPUT_CLASSIFICATION_PER_VERTEX_DATA	<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    D3D12_INPUT_CLASSIFICATION_PER_INSTANCE_DATA	<span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">}</span> 	D3D12_INPUT_CLASSIFICATION<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>于是，当你去定义一个InputLayout时，如果不需要Instance数据，则可以简单地定义为</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">// Define the vertex input layout.</span>
D3D12_INPUT_ELEMENT_DESC inputElementDescs<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;POSITION&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> DXGI_FORMAT_R32G32B32_FLOAT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> D3D12_INPUT_CLASSIFICATION_PER_VERTEX_DATA<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;COLOR&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> DXGI_FORMAT_R32G32B32A32_FLOAT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> D3D12_INPUT_CLASSIFICATION_PER_VERTEX_DATA<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>如果要将他更改为Instance的方式进行绘制，则可以在后方加上Instance的数据</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">// Define the vertex input layout.</span>
D3D12_INPUT_ELEMENT_DESC inputElementDescs<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;POSITION&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> DXGI_FORMAT_R32G32B32_FLOAT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> D3D12_INPUT_CLASSIFICATION_PER_VERTEX_DATA<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;COLOR&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> DXGI_FORMAT_R32G32B32A32_FLOAT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> D3D12_INPUT_CLASSIFICATION_PER_VERTEX_DATA<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;WORLD&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> DXGI_FORMAT_R32G32B32A32_FLOAT<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> D3D12_INPUT_CLASSIFICATION_PER_INSTANCE_DATA<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;WORLD&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> DXGI_FORMAT_R32G32B32A32_FLOAT<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> D3D12_INPUT_CLASSIFICATION_PER_INSTANCE_DATA<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;WORLD&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> DXGI_FORMAT_R32G32B32A32_FLOAT<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> D3D12_INPUT_CLASSIFICATION_PER_INSTANCE_DATA<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;WORLD&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> DXGI_FORMAT_R32G32B32A32_FLOAT<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> D3D12_INPUT_CLASSIFICATION_PER_INSTANCE_DATA<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>接着在Shader当中直接取用Instance数据即可。</p> <p>但是这种绘制方式也有不少受限的地方，受限需要物件是相同模型以及相同材质的，尽管可以给每个物件传递不同的参数来表现出不同的效果，但终究还是受到限制，那么有没有一种更加自由的方式去用单个Draw Call去绘制不同的物件，于是Indirect Draw就横空出世了。</p> <h2 id="indirect-draw"><a href="#indirect-draw" class="header-anchor">#</a> Indirect Draw</h2> <p>对Indirect Draw的简单理解就是将一系列Instance Draw的指令进行打包处理，在CPU端准备好数据指令之后，一次性全部递交到GPU，接着让GPU按照已经指定好的内存排布去计算绘制这一串指令。</p> <p>DX12的官方Sample中提供了一个展示Indirect Draw用法的案例，以下就以该案例为例子来进行说明。</p> <p>DX12中使用ExecuteIndirect指令来执行Indirect Draw，ExecuteIndirect函数的声明如下</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">virtual</span> <span class="token keyword">void</span> STDMETHODCALLTYPE <span class="token function">ExecuteIndirect</span><span class="token punctuation">(</span> 
  <span class="token comment">//指定签名，pArgumentBuffer中的内容将根据签名来进行解释</span>
  _In_  ID3D12CommandSignature <span class="token operator">*</span>pCommandSignature<span class="token punctuation">,</span>
  <span class="token comment">//指令数量</span>
  _In_  UINT MaxCommandCount<span class="token punctuation">,</span>
  <span class="token comment">//存储指令的Buffer</span>
  _In_  ID3D12Resource <span class="token operator">*</span>pArgumentBuffer<span class="token punctuation">,</span>
  <span class="token comment">//每一个指令在Buffer中的偏移</span>
  _In_  UINT64 ArgumentBufferOffset<span class="token punctuation">,</span>
  <span class="token comment">//计数缓冲区</span>
  _In_opt_  ID3D12Resource <span class="token operator">*</span>pCountBuffer<span class="token punctuation">,</span>
  <span class="token comment">//计数缓冲区偏移</span>
  _In_  UINT64 CountBufferOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>可以发现该函数的执行与上述Draw或是InstancedDraw不同，需要一个签名来对指令中的内容进行解释，签名的创建过程如下</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">// Each command consists of a CBV update and a DrawInstanced call.</span>
D3D12_INDIRECT_ARGUMENT_DESC argumentDescs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
argumentDescs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Type <span class="token operator">=</span> D3D12_INDIRECT_ARGUMENT_TYPE_CONSTANT_BUFFER_VIEW<span class="token punctuation">;</span>
argumentDescs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConstantBufferView<span class="token punctuation">.</span>RootParameterIndex <span class="token operator">=</span> Cbv<span class="token punctuation">;</span>
argumentDescs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Type <span class="token operator">=</span> D3D12_INDIRECT_ARGUMENT_TYPE_DRAW<span class="token punctuation">;</span>

D3D12_COMMAND_SIGNATURE_DESC commandSignatureDesc <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
commandSignatureDesc<span class="token punctuation">.</span>pArgumentDescs <span class="token operator">=</span> argumentDescs<span class="token punctuation">;</span>
commandSignatureDesc<span class="token punctuation">.</span>NumArgumentDescs <span class="token operator">=</span> <span class="token function">_countof</span><span class="token punctuation">(</span>argumentDescs<span class="token punctuation">)</span><span class="token punctuation">;</span>
commandSignatureDesc<span class="token punctuation">.</span>ByteStride <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>IndirectCommand<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ThrowIfFailed</span><span class="token punctuation">(</span>m_device<span class="token operator">-&gt;</span><span class="token function">CreateCommandSignature</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>commandSignatureDesc<span class="token punctuation">,</span> m_rootSignature<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">IID_PPV_ARGS</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m_commandSignature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">NAME_D3D12_OBJECT</span><span class="token punctuation">(</span>m_commandSignature<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>签名中声明了每个Command都包含一个Constant Buffer和一个Instanced Draw Call。签名创建完成后，则是准备创建CommandBuffer以及CommandList中每一个绘制Command，CommandBuffer的创建过程如下</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>IndirectCommand<span class="token operator">&gt;</span> commands<span class="token punctuation">;</span>
commands<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>TriangleResourceCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> UINT commandBufferSize <span class="token operator">=</span> CommandSizePerFrame <span class="token operator">*</span> FrameCount<span class="token punctuation">;</span>

<span class="token comment">//创建Command Buffer</span>
D3D12_RESOURCE_DESC commandBufferDesc <span class="token operator">=</span> <span class="token class-name">CD3DX12_RESOURCE_DESC</span><span class="token double-colon punctuation">::</span><span class="token function">Buffer</span><span class="token punctuation">(</span>commandBufferSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">ThrowIfFailed</span><span class="token punctuation">(</span>m_device<span class="token operator">-&gt;</span><span class="token function">CreateCommittedResource</span><span class="token punctuation">(</span>
    <span class="token operator">&amp;</span><span class="token function">CD3DX12_HEAP_PROPERTIES</span><span class="token punctuation">(</span>D3D12_HEAP_TYPE_DEFAULT<span class="token punctuation">)</span><span class="token punctuation">,</span>
    D3D12_HEAP_FLAG_NONE<span class="token punctuation">,</span>
    <span class="token operator">&amp;</span>commandBufferDesc<span class="token punctuation">,</span>
    D3D12_RESOURCE_STATE_COPY_DEST<span class="token punctuation">,</span>
    <span class="token keyword">nullptr</span><span class="token punctuation">,</span>
    <span class="token function">IID_PPV_ARGS</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m_commandBuffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ThrowIfFailed</span><span class="token punctuation">(</span>m_device<span class="token operator">-&gt;</span><span class="token function">CreateCommittedResource</span><span class="token punctuation">(</span>
    <span class="token operator">&amp;</span><span class="token function">CD3DX12_HEAP_PROPERTIES</span><span class="token punctuation">(</span>D3D12_HEAP_TYPE_UPLOAD<span class="token punctuation">)</span><span class="token punctuation">,</span>
    D3D12_HEAP_FLAG_NONE<span class="token punctuation">,</span>
    <span class="token operator">&amp;</span><span class="token class-name">CD3DX12_RESOURCE_DESC</span><span class="token double-colon punctuation">::</span><span class="token function">Buffer</span><span class="token punctuation">(</span>commandBufferSize<span class="token punctuation">)</span><span class="token punctuation">,</span>
    D3D12_RESOURCE_STATE_GENERIC_READ<span class="token punctuation">,</span>
    <span class="token keyword">nullptr</span><span class="token punctuation">,</span>
    <span class="token function">IID_PPV_ARGS</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>commandBufferUpload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">NAME_D3D12_OBJECT</span><span class="token punctuation">(</span>m_commandBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

D3D12_GPU_VIRTUAL_ADDRESS gpuAddress <span class="token operator">=</span> m_constantBuffer<span class="token operator">-&gt;</span><span class="token function">GetGPUVirtualAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
UINT commandIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">//整理Command Data，Command Data中包含绘制所使用的一系列Commands</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>UINT frame <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> frame <span class="token operator">&lt;</span> FrameCount<span class="token punctuation">;</span> frame<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>UINT n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> TriangleCount<span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        commands<span class="token punctuation">[</span>commandIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>cbv <span class="token operator">=</span> gpuAddress<span class="token punctuation">;</span>
        commands<span class="token punctuation">[</span>commandIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>drawArguments<span class="token punctuation">.</span>VertexCountPerInstance <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        commands<span class="token punctuation">[</span>commandIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>drawArguments<span class="token punctuation">.</span>InstanceCount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        commands<span class="token punctuation">[</span>commandIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>drawArguments<span class="token punctuation">.</span>StartVertexLocation <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        commands<span class="token punctuation">[</span>commandIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>drawArguments<span class="token punctuation">.</span>StartInstanceLocation <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        commandIndex<span class="token operator">++</span><span class="token punctuation">;</span>
        gpuAddress <span class="token operator">+=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>SceneConstantBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Copy data to the intermediate upload heap and then schedule a copy</span>
<span class="token comment">// from the upload heap to the command buffer.</span>
D3D12_SUBRESOURCE_DATA commandData <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
commandData<span class="token punctuation">.</span>pData <span class="token operator">=</span> <span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>UINT8<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>commands<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
commandData<span class="token punctuation">.</span>RowPitch <span class="token operator">=</span> commandBufferSize<span class="token punctuation">;</span>
commandData<span class="token punctuation">.</span>SlicePitch <span class="token operator">=</span> commandData<span class="token punctuation">.</span>RowPitch<span class="token punctuation">;</span>

<span class="token generic-function"><span class="token function">UpdateSubresources</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>m_commandList<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m_commandBuffer<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> commandBufferUpload<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>commandData<span class="token punctuation">)</span><span class="token punctuation">;</span>
m_commandList<span class="token operator">-&gt;</span><span class="token function">ResourceBarrier</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token class-name">CD3DX12_RESOURCE_BARRIER</span><span class="token double-colon punctuation">::</span><span class="token function">Transition</span><span class="token punctuation">(</span>m_commandBuffer<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> D3D12_RESOURCE_STATE_COPY_DEST<span class="token punctuation">,</span> D3D12_RESOURCE_STATE_NON_PIXEL_SHADER_RESOURCE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//创建与CommandBuffer关联的SRV</span>
<span class="token comment">// Create SRVs for the command buffers.</span>
D3D12_SHADER_RESOURCE_VIEW_DESC srvDesc <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
srvDesc<span class="token punctuation">.</span>Format <span class="token operator">=</span> DXGI_FORMAT_UNKNOWN<span class="token punctuation">;</span>
srvDesc<span class="token punctuation">.</span>ViewDimension <span class="token operator">=</span> D3D12_SRV_DIMENSION_BUFFER<span class="token punctuation">;</span>
srvDesc<span class="token punctuation">.</span>Shader4ComponentMapping <span class="token operator">=</span> D3D12_DEFAULT_SHADER_4_COMPONENT_MAPPING<span class="token punctuation">;</span>
srvDesc<span class="token punctuation">.</span>Buffer<span class="token punctuation">.</span>NumElements <span class="token operator">=</span> TriangleCount<span class="token punctuation">;</span>
srvDesc<span class="token punctuation">.</span>Buffer<span class="token punctuation">.</span>StructureByteStride <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>IndirectCommand<span class="token punctuation">)</span><span class="token punctuation">;</span>
srvDesc<span class="token punctuation">.</span>Buffer<span class="token punctuation">.</span>Flags <span class="token operator">=</span> D3D12_BUFFER_SRV_FLAG_NONE<span class="token punctuation">;</span>

CD3DX12_CPU_DESCRIPTOR_HANDLE <span class="token function">commandsHandle</span><span class="token punctuation">(</span>m_cbvSrvUavHeap<span class="token operator">-&gt;</span><span class="token function">GetCPUDescriptorHandleForHeapStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CommandsOffset<span class="token punctuation">,</span> m_cbvSrvUavDescriptorSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>UINT frame <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> frame <span class="token operator">&lt;</span> FrameCount<span class="token punctuation">;</span> frame<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    srvDesc<span class="token punctuation">.</span>Buffer<span class="token punctuation">.</span>FirstElement <span class="token operator">=</span> frame <span class="token operator">*</span> TriangleCount<span class="token punctuation">;</span>
    m_device<span class="token operator">-&gt;</span><span class="token function">CreateShaderResourceView</span><span class="token punctuation">(</span>m_commandBuffer<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>srvDesc<span class="token punctuation">,</span> commandsHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    commandsHandle<span class="token punctuation">.</span><span class="token function">Offset</span><span class="token punctuation">(</span>CbvSrvUavDescriptorCountPerFrame<span class="token punctuation">,</span> m_cbvSrvUavDescriptorSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div><p>可以发现CommandBuffer的创建大致可以分为三个步骤</p> <ol><li>使用描述符创建CommandBuffer资源</li> <li>整理Commands，并将CommandData拷贝到CommandBuffer中</li> <li>创建与Command Buffer关联的SRV</li></ol> <p>其中，每个Command由一个Constant Buffer以及一个存放Instance Draw参数的结构体组成，具体组成部分如下</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">typedef</span> UINT64 D3D12_GPU_VIRTUAL_ADDRESS<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">D3D12_DRAW_ARGUMENTS</span>
<span class="token punctuation">{</span>
UINT VertexCountPerInstance<span class="token punctuation">;</span>
UINT InstanceCount<span class="token punctuation">;</span>
UINT StartVertexLocation<span class="token punctuation">;</span>
UINT StartInstanceLocation<span class="token punctuation">;</span>
<span class="token punctuation">}</span> 	D3D12_DRAW_ARGUMENTS<span class="token punctuation">;</span>

<span class="token comment">// Data structure to match the command signature used for ExecuteIndirect.</span>
<span class="token keyword">struct</span> <span class="token class-name">IndirectCommand</span>
<span class="token punctuation">{</span>
    D3D12_GPU_VIRTUAL_ADDRESS cbv<span class="token punctuation">;</span>
    D3D12_DRAW_ARGUMENTS drawArguments<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>至此，已经完成了Indirect Draw中最重要的资源的创建工作，每个Command中数据的创建以及初始化，则和Instance Draw的创建以及初始化大同小异，也就不再过多介绍。</p> <p>然而，在实际使用过程中，当我们使用Indirect Draw来绘制时，通常也会将Culling部分放到Compute Shader中来进行，在DX12这个官方案例中，也包含这种情况下Indirect Draw的使用。</p> <p>在使用Compoute Shader的过程中，需要多创建一份UAV来保存Compute Shader执行之后的结果。之后，则只需要保证Compute Shader以及Indirect Draw的执行时序没有问题即可。</p> <h2 id="结语"><a href="#结语" class="header-anchor">#</a> 结语</h2> <p>关于Indirect Draw，其实最先的接触是在项目当中开发地形渲染相关的部分。尽管当时依葫芦画瓢，也还算顺顺利利地完成了开发，但回过头来看，其实对整个过程，以及上述各种不同的绘制方式之间的区别和差异并不是十分清楚，这才想着回到DX12，从最底层开始梳理一遍整个流程，以及各种Draw之间在实现上的差异在哪里。</p> <p>总的来说，DX12的官方Sample还算是通俗易懂条理清晰，这次也是受益良多。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/eukky/eukky.github.io/edit/dev/docs/GameDev/DirectX/DX12DrawCall.md" target="_blank" rel="noopener noreferrer">Edit</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0a53806a.js" defer></script><script src="/assets/js/2.e7ab5c73.js" defer></script><script src="/assets/js/1.924d8370.js" defer></script><script src="/assets/js/32.a1d95602.js" defer></script>
  </body>
</html>
